# 多智能体剧本编辑系统

一个基于多智能体架构的创新剧本编辑系统，使用调度Agent和多个角色Agents协同工作。

## 🌟 系统特点

- **👤 用户主角**：您将作为主角直接参与剧本对话，真实体验剧情
- **🤖 调度Agent**：负责创建剧本设定、解析角色信息、决定对话顺序
- **🎭 AI角色**：其他角色使用独立的AI智能体，具有独特的性格和记忆
- **🎬 实时对话**：支持用户参与的沉浸式对话体验
- **📊 状态管理**：实时监控系统运行状态和API密钥使用情况
- **🔄 API池管理**：智能分配和管理多个API密钥

## 🏗️ 系统架构

```
┌─────────────────┐    ┌─────────────────┐
│   main.py       │    │   config.py     │
│  程序入口点       │    │   配置文件       │
└─────────────────┘    └─────────────────┘
         │                       │
         ▼                       ▼
┌─────────────────┐    ┌─────────────────┐
│ script_system.py│    │  api_pool.py    │
│   核心系统逻辑    │    │  API密钥池管理   │
└─────────────────┘    └─────────────────┘
         │                       │
         ▼                       ▼
┌─────────────────┐    ┌─────────────────┐
│scheduler_agent.py│    │character_agent.py│
│   调度智能体      │    │   角色智能体     │
└─────────────────┘    └─────────────────┘
```

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirement.txt
```

### 2. 配置API密钥

编辑 `config.py` 文件，添加您的DeepSeek API密钥：

```python
API_KEYS = [
    "sk-your-first-api-key",
    "sk-your-second-api-key",
    # 可以添加更多密钥
]
```

### 3. 运行系统

```bash
python main.py
```

## 📖 使用指南

### 主菜单选项

1. **🎭 创建新剧本** - 输入场景描述，您将成为主角，系统创建其他AI角色
2. **🎬 开始剧本对话** - 优化交互体验，直接输入台词或按回车跳过，流畅参与对话
3. **🎮 交互式对话** - 手动控制对话节奏和情境发展
4. **📊 查看系统状态** - 查看角色信息和API使用状况
5. **🗑️ 清空对话历史** - 重置所有对话记录
6. **🚪 退出系统** - 安全退出程序

### 场景描述示例

- "现代都市背景，朋友们在咖啡厅讨论创业计划"
- "古代武侠世界，我在客栈遇到了神秘的江湖人士"
- "科幻未来，我作为宇宙飞船的船员面临危机"  
- "校园青春，我和同学在图书馆准备重要考试"

### 交互体验优化

**智能对话流程**：
- 🎭 **当轮到您说话时**：直接输入您的台词内容
- ⏭️ **不想说话时**：直接按回车键跳过本轮
- 🔄 **对话节奏**：您说话后直接调度AI角色，AI说话后才会再次询问您
- 🚪 **退出对话**：任何时候输入 'quit' 即可退出

**示例对话流程**：
```
🎭 请输入您的台词 (直接按回车跳过，输入'quit'退出): 大家好，我觉得这个创业想法很有前景
💬 我：大家好，我觉得这个创业想法很有前景

🎯 调度结果：小明 说话
💬 小明：是的，我也这么认为！但是我们需要考虑资金问题...

🎭 请输入您的台词 (直接按回车跳过，输入'quit'退出): [按回车跳过]

🎯 调度结果：小红 说话  
💬 小红：关于资金，我有一些想法...
```

## 🔧 系统组件详解

### 用户主角
- 您直接参与剧本，作为主角与AI角色互动
- 无需消耗API密钥，真实的人类参与
- 系统会在合适的时机调度您发言
- 您的台词会影响剧情发展和其他角色的反应

### 调度Agent (SchedulerAgent)
- 解析用户输入创建剧本设定，自动设置用户为主角
- 提取和管理角色信息（用户主角 + AI角色）
- 根据对话历史决定下一个说话的角色（包括用户）
- 维护全局对话状态

### AI角色Agent (CharacterAgent)
- 每个AI角色拥有独立的API客户端
- 基于角色设定和当前情境生成回应
- 维护个人对话历史
- 保持角色一致性并与用户主角互动

### API池管理 (APIKeyPool)
- 智能分配API密钥给不同角色
- 支持密钥的动态获取和释放
- 处理密钥不足的情况（循环使用）

### 核心系统 (ScriptSystem)
- 协调各个组件的交互
- 提供统一的系统接口
- 管理对话流程和状态

## ⚙️ 配置选项

在 `config.py` 中可以调整以下参数：

- `API_KEYS`: API密钥列表
- `MAX_TOKENS`: 最大令牌数
- `TEMPERATURE`: 生成随机性控制
- `SCHEDULER_SYSTEM_PROMPT`: 调度Agent提示词
- `CHARACTER_SYSTEM_PROMPT_TEMPLATE`: 角色Agent提示词模板

## 🎯 使用技巧

1. **角色扮演**：您是主角，请根据剧情设定和角色背景来回应
2. **场景描述**：在场景描述中明确您的身份和其他角色的特点
3. **对话参与**：积极参与对话，您的台词会影响剧情走向
4. **交互控制**：使用交互式模式可以更精确地控制剧情发展
5. **API管理**：配置多个API密钥可以提高系统稳定性
6. **历史管理**：定期清空历史记录可以重新开始剧情

## 🚨 注意事项

- 确保API密钥有效且有足够余额
- 角色数量会影响API密钥的分配
- 长时间对话可能消耗较多API调用次数
- 系统需要稳定的网络连接

## 🛠️ 故障排除

### 常见问题

**Q: 系统提示"API调用失败"**
A: 检查网络连接和API密钥的有效性

**Q: 角色创建失败**
A: 确保场景描述中包含明确的角色信息

**Q: 调度失败**
A: 可能是API响应格式异常，系统会自动选择默认角色

**Q: 程序意外退出**
A: 检查config.py中的API_KEYS配置是否正确

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

---

**享受您的剧本创作之旅！** 🎭✨ 