# 多智能体剧本编辑系统

一个基于多智能体架构的创新剧本编辑系统，使用调度Agent和多个角色Agents协同工作。

## 🌟 系统特点

- **🤖 调度Agent**：负责创建剧本设定、解析角色信息、决定对话顺序
- **🎭 角色Agents**：每个角色使用独立的API密钥，具有独特的性格和记忆
- **🎬 实时对话**：支持自动和交互式两种对话模式
- **📊 状态管理**：实时监控系统运行状态和API密钥使用情况
- **🔄 API池管理**：智能分配和管理多个API密钥

## 🏗️ 系统架构

```
┌─────────────────┐    ┌─────────────────┐
│   main.py       │    │   config.py     │
│  程序入口点       │    │   配置文件       │
└─────────────────┘    └─────────────────┘
         │                       │
         ▼                       ▼
┌─────────────────┐    ┌─────────────────┐
│ script_system.py│    │  api_pool.py    │
│   核心系统逻辑    │    │  API密钥池管理   │
└─────────────────┘    └─────────────────┘
         │                       │
         ▼                       ▼
┌─────────────────┐    ┌─────────────────┐
│scheduler_agent.py│    │character_agent.py│
│   调度智能体      │    │   角色智能体     │
└─────────────────┘    └─────────────────┘
```

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirement.txt
```

### 2. 配置API密钥

编辑 `config.py` 文件，添加您的DeepSeek API密钥：

```python
API_KEYS = [
    "sk-your-first-api-key",
    "sk-your-second-api-key",
    # 可以添加更多密钥
]
```

### 3. 运行系统

```bash
python main.py
```

## 📖 使用指南

### 主菜单选项

1. **🎭 创建新剧本** - 输入场景描述，系统自动创建剧本设定和角色
2. **🎬 开始自动对话** - 设定对话轮数，系统自动进行角色对话
3. **🎮 交互式对话** - 手动控制对话节奏和情境
4. **📊 查看系统状态** - 查看角色信息和API使用状况
5. **🗑️ 清空对话历史** - 重置所有对话记录
6. **🚪 退出系统** - 安全退出程序

### 场景描述示例

- "现代都市背景，三个朋友在咖啡厅讨论创业计划"
- "古代武侠世界，江湖侠客在客栈相遇"
- "科幻未来，宇宙飞船上的船员面临危机"
- "校园青春，高中生在图书馆准备考试"

## 🔧 系统组件详解

### 调度Agent (SchedulerAgent)
- 解析用户输入创建剧本设定
- 提取和管理角色信息
- 根据对话历史决定下一个说话的角色
- 维护全局对话状态

### 角色Agent (CharacterAgent)
- 每个角色拥有独立的API客户端
- 基于角色设定和当前情境生成回应
- 维护个人对话历史
- 保持角色一致性

### API池管理 (APIKeyPool)
- 智能分配API密钥给不同角色
- 支持密钥的动态获取和释放
- 处理密钥不足的情况（循环使用）

### 核心系统 (ScriptSystem)
- 协调各个组件的交互
- 提供统一的系统接口
- 管理对话流程和状态

## ⚙️ 配置选项

在 `config.py` 中可以调整以下参数：

- `API_KEYS`: API密钥列表
- `MAX_TOKENS`: 最大令牌数
- `TEMPERATURE`: 生成随机性控制
- `SCHEDULER_SYSTEM_PROMPT`: 调度Agent提示词
- `CHARACTER_SYSTEM_PROMPT_TEMPLATE`: 角色Agent提示词模板

## 🎯 使用技巧

1. **角色设计**：在场景描述中明确指定角色的性格特点和背景
2. **对话控制**：使用交互式模式可以更精确地控制剧情发展
3. **API管理**：配置多个API密钥可以提高系统稳定性
4. **历史管理**：定期清空历史记录可以重新开始剧情

## 🚨 注意事项

- 确保API密钥有效且有足够余额
- 角色数量会影响API密钥的分配
- 长时间对话可能消耗较多API调用次数
- 系统需要稳定的网络连接

## 🛠️ 故障排除

### 常见问题

**Q: 系统提示"API调用失败"**
A: 检查网络连接和API密钥的有效性

**Q: 角色创建失败**
A: 确保场景描述中包含明确的角色信息

**Q: 调度失败**
A: 可能是API响应格式异常，系统会自动选择默认角色

**Q: 程序意外退出**
A: 检查config.py中的API_KEYS配置是否正确

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

---

**享受您的剧本创作之旅！** 🎭✨ 